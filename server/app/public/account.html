<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="uft-8">
        <meta name="viewport" content="width=device-width">
        <title>My Account</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link href="stylesheets/account.css" rel="stylesheet" type="text/css" />
        <link href="stylesheets/style.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="./javascripts/script.js"></script>
        <script src="./javascripts/account.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>   <!--Chart.js for graph displays-->
    </head>
    <body>
        <div id="containerContent">
            <!--Navigation Bar-->
            <div id="banner">
				<div id="header">
					<a href="index.html" id="header">Heart Rate Monitoring</a>
				</div>
                <div id="links">
                    <a href="reference.html">References</a>
                    <a href="signup.html">Sign Up</a>
                    <a href="login.html">Login</a>
                    <a href="account.html">My&nbspAccount</a> <!--TODO, remove from home, sign up, login pages after made-->
                    <a href="physician.html">Physician</a> <!--TODO, remove from home, sign up, login pages after made-->
                </div>
            </div>
                <!--Account info section for adding/removing device, changing password, choosing a physician, choosing time range/frequency and logout-->
                <div id="account">
                    <h1 id="accName">Account Information</h1>
                    <h2>Add or Remove Particle Board</h2>
                    <div id="accountInfo">
                        <div class="info">
                            <label for="particleToken">Token: </label>
                            <input type="text" id="particleToken" placeholder="Enter Token" name="particleToken">
                        </div>
                        <div class="info">
                            <label for="particleID">ID: </label>
                            <input type="text" id="particleID" placeholder="Enter ID" name="particleID">
                        </div>
                    </div>
                    <p></p>
                    <button id="particleButton" class="info">Update particle board</button>
                    <h2>Change Password</h2>
                    <div id="accountInfo">
                        <div class="info">
                            <label for="newPassword">New Password: </label>
                            <input type="text" id="newPassword" placeholder="Enter a new password" name="newPassword">
                        </div>
                    </div>
                    <p></p>
                    <button id="newPasswordButton" class="info">Change Password</button>
                    <p></p>
                    <div id="accountInfo">
                        <div class="info">
                            <label for="yourPhysician">Your Physician:</label>
                            <select for="yourPhysician" id="yourPhysician">
                                <!--TODO Need to make it default to whichever physician is chosen-->
                                <option selected=true disabled>No Physician Chosen</option>
                                <!--Script makes physician select tag have as many options as there are physician accounts-->
                                <script>
                                    let numPhysicians = 5;  //replace with physicians length
                                    let physicianHTML = "";
                                    //TODO once connected to recorded data
                                    //replace "Physician ${i}" with physicians[i] email
                                    for(let i = 0; i < numPhysicians; i++) {
                                        physicianHTML += `<option value="${i}">Physician ${i}</option>`;
                                    }
                                    document.getElementById("yourPhysician").innerHTML += physicianHTML;
                                </script>
                            </select>
                        </div>
                    </div>
                    <p></p>
                    <p></p>
                    <div id="accountInfo">
                        <!--Sets start/end/frequency for device measurement requests-->
                        <div class="info">
                            <!--TODO Need to set default values to what is currently selected on board-->
                            <label for="startTime">Start requesting measurements:</label>
                            <select name="startTime" id="startTime">
                                <option value="0">12:00AM</option>
                                <option value="1">1:00AM</option>
                                <option value="2">2:00AM</option>
                                <option value="3">3:00AM</option>
                                <option value="4">4:00AM</option>
                                <option value="5">5:00AM</option>
                                <option value="6">6:00AM</option>
                                <option value="7">7:00AM</option>
                                <option value="8">8:00AM</option>
                                <option value="9">9:00AM</option>
                                <option value="10">10:00AM</option>
                                <option value="11">11:00AM</option>
                                <option value="12">12:00PM</option>
                                <option value="13">1:00PM</option>
                                <option value="14">2:00PM</option>
                                <option value="15">3:00PM</option>
                                <option value="16">4:00PM</option>
                                <option value="17">5:00PM</option>
                                <option value="18">6:00PM</option>
                                <option value="19">7:00PM</option>
                                <option value="20">8:00PM</option>
                                <option value="21">9:00PM</option>
                                <option value="22">10:00PM</option>
                                <option value="23">11:00PM</option>
                            </select>
                        </div>
                        <div class="info">
                            <label for="endTime">Finish requesting measurements:</label>
                            <select name="endTime" id="endTime">
                                <option value="0">12:00AM</option>
                                <option value="1">1:00AM</option>
                                <option value="2">2:00AM</option>
                                <option value="3">3:00AM</option>
                                <option value="4">4:00AM</option>
                                <option value="5">5:00AM</option>
                                <option value="6">6:00AM</option>
                                <option value="7">7:00AM</option>
                                <option value="8">8:00AM</option>
                                <option value="9">9:00AM</option>
                                <option value="10">10:00AM</option>
                                <option value="11">11:00AM</option>
                                <option value="12">12:00PM</option>
                                <option value="13">1:00PM</option>
                                <option value="14">2:00PM</option>
                                <option value="15">3:00PM</option>
                                <option value="16">4:00PM</option>
                                <option value="17">5:00PM</option>
                                <option value="18">6:00PM</option>
                                <option value="19">7:00PM</option>
                                <option value="20">8:00PM</option>
                                <option value="21">9:00PM</option>
                                <option value="22">10:00PM</option>
                                <option value="23">11:00PM</option>
                            </select>
                        </div>
                        <div class="info">
                            <label for="frequency">Frequency of measurements:</label>
                            <select name="frequency" id="frequency">
                                <option value="0">Once every 5 minutes</option>
                                <option value="1">Once every 10 minutes</option>
                                <option value="2">Once every 30 minutes</option>
                                <option value="3">Once every hour</option>
                                <option value="4">Once every 2 hours</option>
                                <option value="5">Once every 4 hours</option>
                                <option value="6">Once every 6 hours</option>
                                <option value="7">Once every 12 hours</option>
                            </select>
                        </div>
                    </div>
                    <p></p>
                    <button id="saveChanges" class="info">Save Changes</button>
                    <p></p>
                    <p></p>
                    <button id="logoutButton">Logout</button>
                </div>
                <div id="summary">
                    <!--Weekly/Daily views-->
                    <h2>Weekly Summary</h2> <!--average, min, max heart rate over 7 days-->
                    <div class="accountInfo">
                        <p>Over the past seven days, your heart rate has been:</p>
                        <p>Average - [TODO input value from db] bpm</p>
                        <p>Maximum - [TODO input value from db] bpm</p>
                        <p>Minimum - [TODO input value from db] bpm</p>
                    </div>
                    <h2>Daily View</h2>
                    <div class="accountInfo">
                        <label for="day">Select a day of the week:</label>
                        <!--Select day to be displayed on charts-->
                        <select name="day" id="day" onchange="displayGraph(this.options[this.selectedIndex].value)">
                            <option id="selectDay" selected=true disabled>Select</option>
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                            <option value="7">Sunday</option>
                        </select>
                        <p></p>
                        <p></p>
                        <button id="resetGraph">Choose a new date</button>
                        <!--Chart.js needs canvas defined before graphs can be made/deleted-->
                        <div id="graphContainer">
                            <canvas id="bpmGraph"></canvas>
                            <canvas id="oxyGraph"></canvas>
                        </div>
                        <!--Script gets data from patient account and displays the corresponding data from the selected day-->
                        <!--Could not get code to work in separate js file, but works directly in html file-->
                        <script>
                            var bpmChart;
                            var oxyChart;

                            document.getElementById("resetGraph").onclick = function() {
                                bpmChart.destroy();
                                oxyChart.destroy();
                                document.getElementById("day").selectedIndex=0;
                                document.getElementById("graphContainer").style.display = "none";
                            }

                            //Chooses the data for a given day (from dropdown) Assuming bpm and oxy saturation formated like this
                            function dayChoice(day) {
                                switch(day) {
                                    //bpm value, oxy percent; blanks are sleep/no recording
                                    //TODO replace set values with patient values 
                                    case "1": var bpm = [82, 84, 83, , , , , , , , , , , 62, 66, 64, 52, 59, 70, 68, 59, 54, 57, 60]; 
                                              var oxy = [95, 95, 96, , , , , , , , , , , 98, 99, 97, 98, 99, 100, 100, 97, 97, 98, 99];
                                              break;
                                    case "2": var bpm = [55, 54, 100, , , , , , , , , , , , , , 69, 57, 68, 64, 58, 62, 67]; 
                                              var oxy = [95, 95, 100, , , , , , , , , , , , , , 97, 94, 95, 97, 95, 98, 97];
                                              break;
                                    case "3": var bpm = [59, 58, , , , , , , , , , , , , 75, 88, 90, 80, 72, 54, 53, 93, 93, 67]; 
                                              var oxy = [97, 95, , , , , , , , , , , , , 96, 98, 97, 98, 96, 100, 97, 95, 94, 96];
                                              break;
                                    case "4": var bpm = [63, 62, 90, , , , , , , , , , 64, 62, 63, 54, 70, 72, 67, 64, 53, 57, 60, 67]; 
                                              var oxy = [94, 94, 96, , , , , , , , , , 93, 99, 100, 100, 97, 96, 96, 95, 94, 97, 94, 99];
                                              break;
                                    case "5": var bpm = [54, 63, 90, , , , , , , 82, 86, 71, 68, 67, 70, 74, 81, , , , 79, 83, 86, 93]; 
                                              var oxy = [95, 95, 96, , , , , , , 100, 98, 97, 96, 96, 98, 97, 98, , , , 97, 96, 98, 99];
                                              break;
                                    case "6": var bpm = [ , , , , , , , 82, 85, 86, 73, 98, 88, 86, 82, 76, 74, 71, 70, 67, 53, 56, 61, ]; 
                                              var oxy = [ , , , , , , , 100, 100, 99, 99, 98, 97, 98, 99, 97, 98, 96, 97, 96, 97, 97, 98, ];
                                              break;
                                    case "7": var bpm = [ , , , , , , , , 70, 69, 65, 74, 73, 78, 83, 88, 87, 90, 92, 93, 66, 62, , ]; 
                                              var oxy = [ , , , , , , , , 99, 98, 99, 97, 97, 97, 99, 98, 98, 99, 99, 100, 99, 99, , ];
                                              break;
                                    default: var bpm = 0; oxy = 0; break;
                                }
                                return [bpm, oxy];
                            }
                            //displays daily view graph for a given day (from dropdown)
                            function displayGraph(day) {

                                let [bpm, oxy] = dayChoice(day);
                                //Shouldnt happen but just incase
                                if(bpm == 0) {
                                    console.log("no choice yet");
                                    return;
                                }

                                //Make chart area visible and code needed for Chart.js to function
                                document.getElementById("graphContainer").style.display = "block";
                                //bpm chart
                                const ctx1 = document.getElementById('bpmGraph');
                                bpmChart = new Chart(ctx1, {
                                    type: 'line',
                                    data: {
                                        //can be replaced with times/values from board
                                        labels: ['12AM', '1AM', '2AM', '3AM', '4AM', '5AM', '6AM', '7AM', '8AM', '9AM', '10AM', '11AM', '12PM', '1PM', '2PM', '3PM', '4PM', '5PM', '6PM', '7PM', '8PM', '9PM', '10PM', '11PM'],
                                        datasets: [{
                                            label: 'Heart Rate',
                                            data: bpm,
                                            borderWidth: 1
                                        }]
                                    },
                                    options: {
                                        maintainAspectRatio: false,
                                        scales: {
                                            y: {
                                                beginAtZero: false
                                            }
                                        }
                                    }
                                });
                                //oxy chart
                                const ctx2 = document.getElementById('oxyGraph');
                                oxyChart = new Chart(ctx2, {
                                    type: 'line',
                                    data: {
                                        //can be replaced with times/values from board
                                        labels: ['12AM', '1AM', '2AM', '3AM', '4AM', '5AM', '6AM', '7AM', '8AM', '9AM', '10AM', '11AM', '12PM', '1PM', '2PM', '3PM', '4PM', '5PM', '6PM', '7PM', '8PM', '9PM', '10PM', '11PM'],
                                        datasets: [{
                                            label: 'Oxygen Saturation',
                                            data: oxy,
                                            borderWidth: 1
                                        }]
                                    },
                                    options: {
                                        maintainAspectRatio: false,
                                        scales: {
                                            y: {
                                                beginAtZero: false
                                            }
                                        }
                                    }
                                });
                            }
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>